### 一.雪花算法相关面试题

**雪花算法**（`Snowflake`）是一种生成分布式全局唯一ID的算法，生成的ID称为`Snowflake IDs`或`snowflakes`。这种算法由`Twitter`创建，并用于推文的ID。

一个`Snowflake ID`有64位。前41位是时间戳，表示了自选定的时期以来的毫秒数。接下来的10位代表计算机ID，防止冲突。其余12位代表每台机器上生成ID的序列号，这允许在同一毫秒内创建多个`Snowflake ID`。`SnowflakeID`基于时间生成，故可以按时间排序。此外，一个ID的生成时间可以由其自身推断出来，反之亦然。该特性可以用于按时间筛选ID，以及与之联系的对象。

#### 1.为什么mysql数据库主键不推荐使用雪花算法？

因为`雪花算法`是趋势递增，如果作为mysql数据库主键，还是容易造成数据/索引页的页分裂，造成一些文件数据碎片，影响数据的查询、添加等效率。

#### 2.那它有什么缺点吗？

- 生成的ID会逐渐增加得比较大，ID不紧凑；
- 不是完全递增的；
- 每个节点每毫秒的ID生成大概在4096个；

#### 3.如何解决万年难遇的时钟回拨？

可以留出2bit或者1bit来作为时钟回拨自增位。如果时钟回拨了，则当前生成的ID必须小于最后的ID，这样可以将回拨位加1，再重新生成新的ID，并初始化最后的ID。并且可以通过异步线程来记录时钟回拨信息，下次机器重启后会保持回拨位的状态。

### 二.新浪微博热点事件技术解决方案？

每次某明星结婚了，新浪微博就宕机一次。像这种大流量访问造成宕机的事件还不好。双11其实道理也是一样的。那如何来解决这种事件呢？

可以通过在线实时监控，来分析出一些热点事件，可以基于Flink、Storm等实时流分析。

发现热点事件后，及时的进行容量扩容等，将数据缓存到本次缓存。缓存的刷新可以基于推模式主动触发到机器上。

可以将一些数据缓存到nginx上，简单的读请求可以不需要再做转发到后端服务。

点赞数、评论数等可以在接收到请求后，记录到mq中，异步来记录到数据并定时刷新缓存数据。

在查看评论列表可以直接查询redis，redis可以做成主从模式，读取直接读取从redis，防止造成大流量打爆单个服务器的网卡。

评论可以只翻页不超过几十页，不需要让用户无限制翻页。如果用户自己评论了，可以让客户端在终端直接展示在最新的评论上，后台还是做异步来处理。

### 三.如果现在的业务扩展两倍，你需要考虑哪些？

未完待续
